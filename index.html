<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rotina da Bebê</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCjy4XjLQxDx0IyA5MNE6JuNDEDzQR3jeU",
      authDomain: "rotinaprincesa.firebaseapp.com",
      projectId: "rotinaprincesa",
      storageBucket: "rotinaprincesa.firebasestorage.app",
      messagingSenderId: "988323884361",
      appId: "1:988323884361:web:892a1681bdddb553273e98",
      databaseURL: "https://rotinaprincesa-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("rotinaForm");
      const resultado = document.getElementById("resultado");
      const dataConsultaInput = document.getElementById("dataConsulta");
      const carregarBtn = document.getElementById("carregarBtn");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const data = form.data.value;
        if (!data) {
          alert("Por favor, preencha a data.");
          return;
        }

        const dados = {
          sono: form.sono.value,
          urina: form.urina.value,
          fezes: form.fezes.value,
          mamada: form.mamada.value,
          estimulo: form.estimulo.value,
          vitamina: form.vitamina.value,
          timestamp: new Date().toISOString()
        };

        const dataRef = ref(db, 'rotina/' + data);
        const novaEntrada = push(dataRef);
        await set(novaEntrada, dados);

        alert("Dados salvos com sucesso!");
        form.reset();
      });

      carregarBtn.addEventListener("click", async () => {
        const dataSelecionada = dataConsultaInput.value;
        if (!dataSelecionada) {
          alert("Por favor, selecione uma data para carregar.");
          return;
        }

        const diaRef = ref(db, 'rotina/' + dataSelecionada);
        const snapshot = await get(diaRef);

        if (snapshot.exists()) {
          const registros = snapshot.val();
          resultado.innerHTML = `<h3>Dados de ${dataSelecionada}</h3>`;
          Object.values(registros).forEach((item, index) => {
            resultado.innerHTML += `
              <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
                <strong>Entrada ${index + 1}</strong><br>
                <b>Sonos:</b> ${item.sono || '-'}<br>
                <b>Urinas:</b> ${item.urina || '-'}<br>
                <b>Fezes:</b> ${item.fezes || '-'}<br>
                <b>Mamadas:</b> ${item.mamada || '-'}<br>
                <b>Estimulação:</b> ${item.estimulo || '-'}<br>
                <b>Vitamina D:</b> ${item.vitamina || '-'}<br>
                <small>${new Date(item.timestamp).toLocaleString()}</small>
              </div>
            `;
          });
        } else {
          resultado.innerHTML = `<p>Nenhum dado encontrado para ${dataSelecionada}.</p>`;
        }
      });
    });
  </script>
</head>
<body>
  <h1>Rotina da Bebê</h1>

  <form id="rotinaForm">
    <label>Data (obrigatório): <input type="date" name="data" required /></label><br />
    <label>Sonos: <textarea name="sono"></textarea></label><br />
    <label>Urinas: <textarea name="urina"></textarea></label><br />
    <label>Fezes: <textarea name="fezes"></textarea></label><br />
    <label>Mamadas: <textarea name="mamada"></textarea></label><br />
    <label>Estimulação: <textarea name="estimulo"></textarea></label><br />
    <label>Vitamina D: <input type="text" name="vitamina" /></label><br />
    <button type="submit">Salvar</button>
  </form>

  <hr>
  <h2>Consultar Dados por Data</h2>
  <label>Escolha a data: <input type="date" id="dataConsulta" /></label>
  <button id="carregarBtn">Carregar Dados</button>

  <div id="resultado"></div>
</body>
</html>
